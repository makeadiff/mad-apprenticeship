import{e as y,f as P,k as E}from"https://st-p.rmcdn.net/aab27dd3/dist/c/c-J3USEBGX.js";import{a as p,b as C}from"https://st-p.rmcdn.net/aab27dd3/dist/c/c-RAPBUJGJ.js";import{a as l,f as g}from"https://st-p.rmcdn.net/aab27dd3/dist/c/c-QHP3NFJY.js";var f=l(()=>{"use strict"});var T,O,A,S,q,w,_=l(()=>{"use strict";C();T=(s,e)=>p.post(`/api/ecommerce/${s}/stripe/checkout-session`,{...e}),O=(s,e)=>p.get(`/api/ecommerce/${s}/stripe/customer/by-checkout-session/${e}`),A=(s,e)=>p.post(`/api/ecommerce/${s}/stripe/billing-portal-session`,{...e}),S=(s,e)=>p.get(`/api/connect/ecommerce/${e}/disconnect?num_id=${s}`),q=(s,e)=>p.get(`/api/${e?"published_projects":"projects"}/${s}/ecommerce/stripe/products`),w=(s,e)=>p.get(`/api/ecommerce/${s}/ecwid/products${e}`)});var h,b,v=l(()=>{"use strict";f();_();E();h=["SELECT","SIZE","RADIO"],b=class{constructor(e){g(this,"numId");g(this,"libraryAdded",!1);this.numId=e}async disconnect(e){return await S(e,"ecwid")}async loadProducts(e,r,t){let c=t&&window?.RM?.screenshotMode==="preview"?"?type=preview":r?"?type=published":"";return(await w(e,c)).data||[]}mapProductsToSelectOptions(e,r){let t=e.map(c=>({value:c.id,caption:c.name}));return r&&r!=="default"&&!t.find(c=>c.value===r)&&t.unshift({value:r,caption:"inactive product"}),t.unshift({value:"default",caption:"None"}),t}isProductActive(e){return!!e.active}productHasActiveOptions(e){return!!e.options?.some(r=>h.includes(r.type))}productHasActivePrice(e){return Array.isArray(e.prices)&&!!e.prices?.some(r=>r.active)}isProductAvailable(e){if(e.inStock){let r=e.selectedCombination||e;if(typeof r.quantity>"u"||r.quantity)return!0}return!1}getProductForAddToCart(e,r){let t={...e};if(t&&r&&(t.selectedOptions={...r},Array.isArray(t.combinations))){let c=t.combinations.find(i=>i.options.every(o=>r[o.name]===o.value));c&&(t.selectedCombination={...c})}return t}initFrontendLibrary(e){if(!this.libraryAdded&&e?.ecwid?.serviceData){let r=document.createElement("script"),t=`https://app.ecwid.com/script.js?${e.ecwid.serviceData.storeId}&data_platform=code`;r.setAttribute("async","async"),r.setAttribute("charset","utf-8"),r.setAttribute("src",t),document?.body?.appendChild(r),this.libraryAdded=!0}}getFormattedProductToAddToCart(e,r){let t={...e},c=P(),i={id:t.id.toString(),name:t.name,nameTranslated:t.nameTranslated[c]||t.name,image:t.images?.[0],price:t.price,currency:t.currency};if(typeof t.quantity=="number"&&(i.quantity=t.quantity),r&&Object.keys(r).length){i.options={...r};let o=t.price;if(Array.isArray(t.combinations)){let a=t.combinations.find(u=>u.options.every(n=>r[n.name]===n.value));a&&(a.price&&(o=a.price),a.thumbnailUrl&&(i.image=a.thumbnailUrl),typeof a.quantity=="number"?i.quantity=a.quantity:i.quantity&&delete i.quantity)}if(t.options){for(let a in r){let u=t.options.find(d=>d.name===a),n=u?u.choices?.find(d=>d.text===r[a]):null;n&&n.priceModifier&&(n.priceModifierType==="ABSOLUTE"?o+=n.priceModifier:n.priceModifierType==="PERCENT"&&(o+=o*Number((n.priceModifier/100).toFixed(2))))}i.optionsTranslated=Object.fromEntries(Object.entries(i.options).map(([a,u])=>{let n=t.options?.find(m=>m.name===a);if(!n)return[a,u];let d=y(n);return[d.translatedName,d.translatedValues[u]]}))}o&&o!==i.price&&(i.price=o)}return i}waitEcwidPopupClose(e){let t=".ecwid-popup",c=setInterval(()=>{document.querySelector(t)||(clearInterval(c),e())},500)}goToCheckout({items:e,callbacks:r}){let{onOpen:t,onPlaced:c,onClose:i}=r||{},o=window?.Ecwid;if(!o){console.error("No ecwid global library");return}o.init(),o.Cart.clear();let a=Object.keys(e).length,u=[];for(let n in e){let d={id:Number(e[n].id),quantity:e[n].cartQuantity,callback:m=>{m&&u.push(n),a===u.length&&(o.Cart.gotoCheckout(),t&&t(),i&&this.waitEcwidPopupClose(i),o.OnOrderPlaced.add(()=>{c&&c()}))}};e[n].options&&(d.options=e[n].options),o.Cart.addProduct(d)}}}});export{f as a,T as b,O as c,A as d,S as e,q as f,_ as g,h,b as i,v as j};
