import{a as S,b as T}from"https://st-p.rmcdn.net/aab27dd3/dist/c/c-3YUZTX2N.js";import{a as w,b as E}from"https://st-p.rmcdn.net/aab27dd3/dist/c/c-MAHC2LGO.js";import{a as A}from"https://st-p.rmcdn.net/aab27dd3/dist/c/c-AU5RUMUL.js";import{a as v,c as C}from"https://st-p.rmcdn.net/aab27dd3/dist/c/c-RFIBFC7T.js";import{a as b,d as D,f as s}from"https://st-p.rmcdn.net/aab27dd3/dist/c/c-QHP3NFJY.js";var g,F,y,B=b(()=>{"use strict";g=D(A());C();E();F=6,y=class{constructor(e,a,t,i){this.onAllImagesLoaded=i;s(this,"imageInstances",[]);s(this,"imagesLoaded",0);s(this,"isLoading",!1);s(this,"seekCallbackData");s(this,"areAllImagesLoaded",!1);if(v())return;let r=(0,g.range)(1,a+1).map(n=>this.getImageUrl(e,n,t));for(let n of r)this.imageInstances.push({imagePreloader:this.createPreloader(n),isLoaded:!1,url:n})}async preloadFirstImage(){return this.loadImage(0)}async loadImage(e){let a=this.imageInstances[e];if(!a||a.isLoaded)return;let t=await a.imagePreloader.preload();a.imageSource=t,a.isLoaded=!0,this.imagesLoaded++,this.imageInstances.length===this.imagesLoaded&&(this.areAllImagesLoaded=!0,this.isLoading=!1,this.onAllImagesLoaded&&this.onAllImagesLoaded()),this.seekCallbackData&&this.seekCallbackData.index===e&&(this.seekCallbackData.callback(a.imageSource),this.seekCallbackData=void 0)}startLoad(){if(this.isLoading)return;this.areAllImagesLoaded=!1,this.isLoading=!0;let e=[0],a=Math.ceil(Math.log(this.imageInstances.length)/Math.log(2));for(let t=1;t<=a;t++){let i=Math.pow(2,t),r=Math.ceil(this.imageInstances.length/i);for(let n=1;n<=i;n++){let d=n*r;e.push(d)}}e=(0,g.uniq)(e).filter(t=>t<this.imageInstances.length);for(let t of e)this.loadImage(t)}stopLoad(){if(this.isLoading){for(let e of this.imageInstances)e.isLoaded||e.imagePreloader.abort();this.isLoading=!1}}async seekImageByIndex(e){this.seekCallbackData&&(this.seekCallbackData.callback(void 0),this.seekCallbackData=void 0);let a=e;return new Promise(t=>{e>this.imageInstances.length-1&&(a=this.imageInstances.length-1),e<0&&(a=0);let i=this.imageInstances[a];if(i.isLoaded)return t(i.imageSource);this.seekCallbackData={index:a,callback:t}})}getImageIndexByTimelinePercent(e){return Math.floor(this.imageInstances.length*e)}getNumberOfImages(){return this.imageInstances.length}createPreloader(e){let a=new Image;return{async preload(){return new Promise((t,i)=>{a.onerror=i,a.onload=()=>{t(a)},w(()=>{a.src=e})})},abort(){a.onload=null,a.src=""}}}getImageUrl(e,a,t){return`${e}/${a.toString().padStart(F,"0")}.${t||"jpg"}?c`}}});var u,p,q,L,R=b(()=>{"use strict";T();u=400,p=16.66,q=Math.floor(u/p),L=class{constructor(e,a,t){s(this,"canvas");s(this,"imageLoader");s(this,"easingType",1);s(this,"lastDrawnFrameIndex");s(this,"easingSequenceId");s(this,"lastEasingCallTime",0);s(this,"lastTargetIndex",0);s(this,"isPlayingAnimation",!1);s(this,"isPaused",!1);s(this,"byStepReverse",!1);this.canvas=e,this.imageLoader=a,this.easingType=t}drawImageByIndex(e,a=!1){return a?this.startEasingSequence(e):this.imageLoader.seekImageByIndex(e).then(t=>this.drawImage(t,e))}drawImageByTimelinePercent(e,a=!1){let t=this.imageLoader.getImageIndexByTimelinePercent(e);return this.drawImageByIndex(t,a)}startDrawingByStep(e,{speed:a,loop:t,spring:i}){let r=o=>o*p/a,d=r(e),l=null;this.isPlayingAnimation=!0;let c=o=>{if(!l&&this.isPaused&&this.lastDrawnFrameIndex){let I=this.byStepReverse?e-this.lastDrawnFrameIndex:this.lastDrawnFrameIndex;l=o-r(I+1),this.isPaused=!1}else l||(l=o);let h=Math.min((o-l)/d,1),m=Math.floor(h*(e-0)+0)/1;this.drawImageByIndex(this.byStepReverse?e-m:m).then(()=>{h===1&&t?(l=o,i&&(this.byStepReverse=!this.byStepReverse)):h===1&&(this.isPlayingAnimation=!1),this.isPlayingAnimation&&window.requestAnimationFrame(c)})};window.requestAnimationFrame(c)}stopDrawingByStep(){this.isPlayingAnimation=!1}pauseDrawingByStep(){this.isPlayingAnimation=!1,this.isPaused=!0}drawImage(e,a){return new Promise((t,i)=>{if(!e||a===this.lastDrawnFrameIndex)return t();let r=this.canvas.getContext("2d");if(!r)return i(new Error("Cannot find context to paint on"));let n,d,l=0,c=0,o=e.height/e.width;this.canvas.height/this.canvas.width>o?(n=this.canvas.height/o,d=this.canvas.height,l=(this.canvas.width-n)/2):(n=this.canvas.width,d=this.canvas.width*o,c=(this.canvas.height-d)/2),window.requestAnimationFrame(()=>{r.clearRect(0,0,this.canvas.width,this.canvas.height),r.drawImage(e,0,0,e.width,e.height,l,c,n,d),this.lastDrawnFrameIndex=a,t()})})}startEasingSequence(e){clearInterval(this.easingSequenceId);let a=this.lastDrawnFrameIndex||0;return new Promise(t=>{let i=Date.now(),r=i-this.lastEasingCallTime,n=Math.abs(this.lastTargetIndex-e)/r,d=Math.round(n/r*this.imageLoader.getNumberOfImages()*2),l=Math.min(Math.round(this.imageLoader.getNumberOfImages()*.05),q,this.easingType===0?d:Math.ceil(u/r));this.lastEasingCallTime=i,this.lastTargetIndex=e;let c=e-a,o=e-Math.sign(c)*Math.min(l,Math.abs(e-a)),h=e-o,m=i,I=m+u;this.drawImageByIndex(o),this.easingSequenceId=setInterval(()=>{let f=Date.now();if(f>I)return clearInterval(this.easingSequenceId),this.easingSequenceId=void 0,t();let x=(f-m)/u,k=S.easeOutCubic(x),M=Math.round(h*k)+o;this.drawImageByIndex(M)},p)})}}});export{y as a,B as b,L as c,R as d};
